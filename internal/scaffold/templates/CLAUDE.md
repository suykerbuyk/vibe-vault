# Claude Code Knowledge Vault

## Purpose

This vault is a **persistent knowledge base** that captures insights, decisions, patterns, and session summaries from working with Claude Code. It complements your AI assistant's memory system without duplicating it.

**What goes here:** Durable knowledge, decisions, patterns, learnings, and session logs worth preserving.
**What stays in PAI:** Active session state, auto-memory, working context, ephemeral notes.

## PUBLIC REPOSITORY — No PII Allowed

This is a **public template repository**. Every file committed here is visible to the internet.

**Non-negotiable rules:**
- NEVER commit real usernames, email addresses, or full names
- NEVER commit real project names from work or personal repos
- NEVER commit API keys, tokens, or secrets
- NEVER commit absolute home directory paths (use `~` or generic paths)
- Use generic examples: `acme-api`, `my-cli-tool`, `user@example.com`

**Enforcement (2 layers):**
1. **Pre-push hook** — scans all tracked files, blocks push to origin
2. **CI workflow** — `pii-scan` job runs on every push/PR, catches bypasses

No pre-commit hook (obsidian-git auto-commits would silently fail). Patterns are defined in `.pii-patterns`. Run `./scripts/install-hooks.sh` after cloning.

## Session Capture: vibe-vault (`vv`)

Session capture is handled by **`vv`** (vibe-vault), a standalone Go binary. Source at `~/code/vibe-vault`. It replaces the previous TypeScript hook system entirely.

### Hook Integration

```json
{
  "hooks": {
    "SessionEnd": [{
      "matcher": "",
      "hooks": [{"type": "command", "command": "vv hook"}]
    }]
  }
}
```

### Configuration

`~/.config/vibe-vault/config.toml`:
```toml
vault_path = "~/obsidian/ObsMeetings"

[domains]
work = "~/work"
personal = "~/personal"
opensource = "~/opensource"

[enrichment]
enabled = false
timeout_seconds = 10
provider = "openai"
model = "grok-3-mini-fast"
api_key_env = "XAI_API_KEY"
base_url = "https://api.x.ai/v1"

[archive]
compress = true
```

### Data Flow

```
Claude Code SessionEnd
    → stdin JSON (session_id, transcript_path, cwd)
    → vv hook
    → Parse full JSONL transcript
    → Extract stats (duration, tokens, files changed, message count)
    → Detect project/domain/branch from cwd
    → Find previous session (session-index.json)
    → Render Obsidian markdown note
    → Update session index
    → Write to Projects/{project}/sessions/YYYY-MM-DD-NN.md
```

### CLI Commands

```
vv hook                  # Claude Code hook mode (reads stdin)
vv process <file.jsonl>  # Process a single transcript
vv version               # Print version
```

Future commands (not yet implemented):
```
vv backfill              # Discover + process all unprocessed sessions
vv reprocess             # Re-extract archived transcripts
vv index                 # Rebuild project context
```

## Vault Conventions

### Frontmatter Schema

Every note requires this frontmatter:

```yaml
---
date: YYYY-MM-DD          # required
type: session|decision|pattern|learning|knowledge  # required
domain: work|personal|opensource  # required
status: active|completed|archived  # required
tags: []                   # required, from controlled vocabulary
summary: ""                # required, one-line description
project: ""                # optional, project name
model: ""                  # optional, Claude model used
duration_minutes:          # optional, session length
source_sessions: []        # optional, links to related sessions
category: ""               # optional, knowledge category
---
```

### Session Note Frontmatter (generated by `vv`)

```yaml
---
date: YYYY-MM-DD
type: session
project: project-name
branch: git-branch
domain: work|personal|opensource
model: claude-opus-4-6
session_id: "uuid"
iteration: 1
duration_minutes: 45
messages: 24
tokens_in: 52000
tokens_out: 18000
tool_uses: 85
tools: [Bash, Edit, Glob, Grep, Read, Write]
status: completed
friction_score: 28
corrections: 2
tags: [cortana-session]
summary: "One-line description"
previous: "[[YYYY-MM-DD-NN]]"
---
```

### Domain Taxonomy

| Domain | Maps To | Description |
|--------|---------|-------------|
| `work` | `~/work/` | Work projects |
| `personal` | `~/personal/` | Personal projects |
| `opensource` | `~/opensource/` | Open source contributions |

Workspace directories are configured in `~/.config/vibe-vault/config.toml`.

### Controlled Tag Vocabulary

Only use these tags to keep the vault searchable and consistent:

- `cortana-session` — Session log/summary
- `knowledge` — Extracted knowledge note
- `decision` — Architectural or design decision
- `pattern` — Reusable pattern discovered
- `learning` — Lesson learned (what worked/failed)
- `research` — Research findings
- `implementation` — Implementation work
- `debugging` — Bug investigation/fix
- `review` — Code or design review
- `planning` — Planning session
- `exploration` — Codebase or concept exploration

### Folder Purposes

| Folder | Purpose |
|--------|---------|
| `Projects/{project}/sessions/` | Session logs organized by project, named `YYYY-MM-DD-NN.md` |
| `Knowledge/decisions/` | Architectural and design decisions |
| `Knowledge/patterns/` | Reusable patterns and approaches |
| `Knowledge/learnings/` | Lessons learned from successes and failures |
| `Projects/` | Project-specific index notes |
| `Templates/` | Templater templates for new notes |
| `Dashboards/` | Dataview-powered overview pages (sessions, decisions, action-items, weekly-digest, by-project, analytics) |
| `_archive/` | Completed or superseded notes |

### State Files (gitignored)

| Path | Purpose |
|------|---------|
| `.vibe-vault/session-index.json` | Session ID → note path, project, date, title |
| `Projects/{project}/` | Per-project files including history.md and sessions/ |

## Anti-Patterns

- **No memory duplication** — Don't copy Claude Code's auto-memory verbatim. Summarize and enrich.
- **No graph view optimization** — Don't add links just for graph aesthetics. Link when meaningful.
- **No iCloud sync** — Use git for versioning. iCloud causes sync conflicts with Obsidian.
- **No folder-based domain split** — Use `domain` and `project` frontmatter. Sessions are organized under `Projects/{project}/sessions/`.
- **No manual dashboards** — All dashboards use Dataview queries. Never maintain lists by hand.
- **No tag sprawl** — Only use tags from the controlled vocabulary above.

## Vault Access Pattern (Two-Pass Retrieval)

When accessing vault knowledge — whether via `/recall` or ad-hoc ("look up that decision about enrichment") — follow the two-pass pattern to minimize context usage:

1. **Check auto-loaded summaries first** — VaultContextLoader already injected frontmatter summaries at session start (look for "Vault Knowledge (Auto-loaded)" in your context). If the answer is there, stop. Zero additional cost.
2. **Grep, don't bulk-read** — Use `Grep` to search `summary:` fields and note bodies for the topic. Read only the frontmatter (first 15 lines) of matches to assess relevance.
3. **Read selectively** — Only `Read` full note bodies for the 2-3 most relevant matches. Never bulk-read an entire directory.
4. **Cap at 5 full reads** — If you need more than 5 note bodies, you should be using `/recall` with filters, not ad-hoc access.

**What NOT to do:**
- Do not read every `.md` file in a directory to find information
- Do not read full note bodies when the frontmatter summary answers the question
- Do not skip the auto-loaded summaries and go straight to filesystem search
